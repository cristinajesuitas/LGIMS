SELECT 
CASE 
WHEN AGE BETWEEN 10 AND 14 THEN '10-14'
WHEN AGE BETWEEN 15 AND 19 THEN '15-19'
WHEN AGE BETWEEN 20 AND 24 THEN '20-24'
WHEN AGE BETWEEN 25 AND 29 THEN '25-29'
WHEN AGE BETWEEN 30 AND 34 THEN '30-34'
WHEN AGE BETWEEN 35 AND 39 THEN '35-39'
WHEN AGE BETWEEN 40 AND 44 THEN '40-44'
WHEN AGE BETWEEN 45 AND 49 THEN '45-49'
WHEN AGE BETWEEN 50 AND 54 THEN '50-54'
WHEN AGE BETWEEN 55 AND 59 THEN '55-59'
WHEN AGE BETWEEN 60 AND 64 THEN '60-64'
WHEN AGE BETWEEN 65 AND 69 THEN '65-69'
WHEN AGE BETWEEN 70 AND 74 THEN '70-74'
WHEN AGE BETWEEN 75 AND 79 THEN '75-79'
WHEN AGE >79 THEN '80 and over'
END AS AGE_GROUP,
CASE 
WHEN AGE BETWEEN 10 AND 14 THEN SUM(CASE WHEN MALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 15 AND 19 THEN SUM(CASE WHEN MALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 20 AND 24 THEN SUM(CASE WHEN MALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 25 AND 29 THEN SUM(CASE WHEN MALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 30 AND 34 THEN SUM(CASE WHEN MALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 35 AND 39 THEN SUM(CASE WHEN MALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 40 AND 44 THEN SUM(CASE WHEN MALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 45 AND 49 THEN SUM(CASE WHEN MALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 50 AND 54 THEN SUM(CASE WHEN MALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 55 AND 59 THEN SUM(CASE WHEN MALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 60 AND 64 THEN SUM(CASE WHEN MALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 65 AND 69 THEN SUM(CASE WHEN MALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 70 AND 74 THEN SUM(CASE WHEN MALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 75 AND 79 THEN SUM(CASE WHEN MALES THEN 1 ELSE 0 END)
WHEN AGE >79 THEN SUM(CASE WHEN MALES THEN 1 ELSE 0 END) END AS MALE,
CASE 
WHEN AGE BETWEEN 10 AND 14 THEN SUM(CASE WHEN FEMALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 15 AND 19 THEN SUM(CASE WHEN FEMALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 20 AND 24 THEN SUM(CASE WHEN FEMALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 25 AND 29 THEN SUM(CASE WHEN FEMALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 30 AND 34 THEN SUM(CASE WHEN FEMALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 35 AND 39 THEN SUM(CASE WHEN FEMALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 40 AND 44 THEN SUM(CASE WHEN FEMALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 45 AND 49 THEN SUM(CASE WHEN FEMALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 50 AND 54 THEN SUM(CASE WHEN FEMALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 55 AND 59 THEN SUM(CASE WHEN FEMALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 60 AND 64 THEN SUM(CASE WHEN FEMALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 65 AND 69 THEN SUM(CASE WHEN FEMALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 70 AND 74 THEN SUM(CASE WHEN FEMALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 75 AND 79 THEN SUM(CASE WHEN FEMALES THEN 1 ELSE 0 END)
WHEN AGE >79 THEN SUM(CASE WHEN FEMALES THEN 1 ELSE 0 END) END AS FEMALE,
CASE
WHEN AGE BETWEEN 10 AND 14 THEN SUM(CASE WHEN MALES THEN 1 ELSE 0 END) + SUM(CASE WHEN FEMALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 15 AND 19 THEN SUM(CASE WHEN MALES THEN 1 ELSE 0 END) + SUM(CASE WHEN FEMALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 20 AND 24 THEN SUM(CASE WHEN MALES THEN 1 ELSE 0 END) + SUM(CASE WHEN FEMALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 25 AND 29 THEN SUM(CASE WHEN MALES THEN 1 ELSE 0 END) + SUM(CASE WHEN FEMALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 30 AND 34 THEN SUM(CASE WHEN MALES THEN 1 ELSE 0 END) + SUM(CASE WHEN FEMALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 35 AND 39 THEN SUM(CASE WHEN MALES THEN 1 ELSE 0 END) + SUM(CASE WHEN FEMALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 40 AND 44 THEN SUM(CASE WHEN MALES THEN 1 ELSE 0 END) + SUM(CASE WHEN FEMALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 45 AND 49 THEN SUM(CASE WHEN MALES THEN 1 ELSE 0 END) + SUM(CASE WHEN FEMALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 50 AND 54 THEN SUM(CASE WHEN MALES THEN 1 ELSE 0 END) + SUM(CASE WHEN FEMALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 55 AND 59 THEN SUM(CASE WHEN MALES THEN 1 ELSE 0 END) + SUM(CASE WHEN FEMALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 60 AND 64 THEN SUM(CASE WHEN MALES THEN 1 ELSE 0 END) + SUM(CASE WHEN FEMALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 65 AND 69 THEN SUM(CASE WHEN MALES THEN 1 ELSE 0 END) + SUM(CASE WHEN FEMALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 70 AND 74 THEN SUM(CASE WHEN MALES THEN 1 ELSE 0 END) + SUM(CASE WHEN FEMALES THEN 1 ELSE 0 END)
WHEN AGE BETWEEN 75 AND 79 THEN SUM(CASE WHEN MALES THEN 1 ELSE 0 END) + SUM(CASE WHEN FEMALES THEN 1 ELSE 0 END)
WHEN AGE >79 THEN SUM(CASE WHEN MALES THEN 1 ELSE 0 END) + SUM(CASE WHEN FEMALES THEN 1 ELSE 0 END)
END AS TOTAL_SEXES

FROM (SELECT DATE_FORMAT(FROM_DAYS(DATEDIFF(NOW(),bdate)), '%Y') AS AGE,
 cap_citizen.cap_sex_id = '13' AS MALES, cap_citizen.cap_sex_id = '12' AS FEMALES
 FROM cap_citizen) as DERIVED

GROUP BY AGE
union all
select 'Total', SUM(DATE_FORMAT(FROM_DAYS(DATEDIFF(NOW(),bdate)), '%Y') BETWEEN 10 AND 200 AND cap_citizen.cap_sex_id = '13'),SUM(DATE_FORMAT(FROM_DAYS(DATEDIFF(NOW(),bdate)), '%Y') BETWEEN 10 AND 200 AND cap_citizen.cap_sex_id = '12'), 
SUM(DATE_FORMAT(FROM_DAYS(DATEDIFF(NOW(),bdate)), '%Y') >10) 

FROM cap_citizen

